bl-webapp
=========

A bl module that adds webapp capabilities to any other module as a dependency. build.gradle:

    dependencies {
        compile project(':bl-webapp')
    }

To generate an all-in-one fat jar, add this to your module's build.gradle:

    fatJar {
        classifier = 'fat'
        manifest = defaultManifest()
        manifest.attributes 'Main-Class': 'com.blacklocus.webapp.RunServer'
        exclude 'META-INF/*.SF'
        exclude 'META-INF/*.DSA'
        exclude 'META-INF/*.RSA'
    }

To run this within IntelliJ, create a new Run Configuration on `RunServer` and adjust "Use classpath of module" away
from bl-webapp to whatever user module.


web resources
-------------

Create classes that extend `com.blacklocus.webapp.base.BaseJsonResource` and annotate them in the usual Jersey ways.
Note that RunServer initializes Jersey with a `SingletonFactory`, so all web resources and providers must be threadsafe.
Example:

    @Path("/stuff")
    public class Stuff extends BaseJsonResource {

        private final MyService myService;

        // Jersey has a dead simple DI mechanic. To create injectable instances, annotate them with @Provider.
        public Stuff(@InjectParam MyService myService) {
            this.myService = myService;
        }

        @GET
        public String helloWorld() {
            return "hello world";
        }

        @GET
        public ResponsePojo example(@QueryParam("isContrived") Boolean isContrived) {
            ResponsePojo response = new ResponsePojo();
            response.success = isContrived;
            // Note that by extending BaseJsonResource, objects will be serialized to/from json using
            // com.blacklocus.webapp.app.DefaultObjectMapper
            return response;
        }
    }

    class ResponsePojo {
        public Boolean success;
    }

Look at bl-magnus for more examples.




static files
------------

Place them in your project directory under `src/main/webapp/static/`. To mark them as source files in both IntelliJ
and in the fat jar build, build.gradle:

    sourceSets {
        main.resources.srcDir 'src/main/webapp'
    }

The static/ directory will end up at the root of the fat jar.

### Development ###

IntelliJ copies files to a temporary directory on build/run. If you would like to be able to edit static files while
your webapp is running, this property will cause RunServer to configure Jetty to point directly at your source
directories rather than the temporary build out generated by IntelliJ. Notice here, the `static/` dir is not implied
and must be explicitly included:

    -Dbase.static_dirs=bl-yourModule/src/main/webapp/static/

This property does accept multiple locations, if such a layering during development is desired.

    -Dbase.static_dirs=bl-magnus/src/main/webapp/static/;base-this-or-that/src/main/webapp/static/